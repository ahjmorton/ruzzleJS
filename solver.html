<!DOCTYPE HTML>
<html>
    <head>
        <script>
            "use strict"
            var App = function() {
                var WORDLIST_FILE = "worker.js";
                var LETTERS_PER_WORKER = 4;
                var RESULT_LIST_ELEMENT = "wordlist";
                function sublists(array, size) {
                    return array.reduce(function(previousValue, nextValue, index) {
                        if(index % size === 0) {
                            previousValue.push([nextValue]);
                        }
                        else {
                            previousValue[previousValue.length - 1].push(nextValue);
                        }
                        return previousValue;
                    }, []);
                };
                function startWork(grid, resultFunc) {
                    var assignments = sublists(grid, LETTERS_PER_WORKER); 
                    console.log(assignments);
                    var gridToSendToWorkers = sublists(grid, 4);
                    for(var i = 0; i < assignments.length; i++) {
                        var worker = new Worker(WORDLIST_FILE);
                        worker.postMessage({cmd:"start", grid:gridToSendToWorkers, letters:assignments[i]});
                        worker.addEventListener('message', function(msgData) {
                            resultFunc(msgData.data);
                        });
                    }
                };
                var listHandler = function ListHandler() {
                    var wordList = undefined;
                    function getWordList() {
                        if(typeof wordList === 'undefined') {
                            wordList = document.getElementById("wordList");
                        }
                        return wordList;
                    }
                    return {
                        add : function(word) {
                            var li = document.createElement("li");
                            li.appendChild(document.createTextNode(word));
                            getWordList().appendChild(li);
                        },
                        clear : function() {
                            getWordList().innerHTML = "";
                        }
                    };
                }();
                return {
                    start : function() {
                        var theGrid = ['a','y','r','p','k','l','u','b','o','t','s','h','c','v','m','i'];
                        startWork(theGrid, listHandler.add);
                    }
                };
            }();
            window.onload=App.start;
        </script>
    </head>
    <body>
        <h1>Generated words</h1>
        <ul id="wordList">
        </ul>
    </body>
</html>
